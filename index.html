<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>PROBRO</title>

<style>

/* ===== GLOBAL THEME ===== */

:root{
    --bg:#050505;
    --panel:#0c0c0c;
    --accent:#a855f7;
    --text:#e5e5e5;
    --muted:#666;
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:"Courier New", monospace;
}

body{
    background:var(--bg);
    color:var(--text);
    height:100vh;
    display:flex;
}

/* ===== SIDEBAR ===== */

.sidebar{
    width:240px;
    background:var(--panel);
    padding:20px;
    display:flex;
    flex-direction:column;
    transition:.25s;
}

.sidebar.collapsed{
    width:70px;
}

.sidebar h3{
    font-size:12px;
    color:var(--muted);
    margin-bottom:12px;
    letter-spacing:2px;
}

.island-btn{
    background:none;
    border:none;
    color:var(--muted);
    padding:10px 0;
    text-align:left;
    cursor:pointer;
    transition:.2s;
}

.island-btn.active{
    color:var(--accent);
}

/* ===== MAIN AREA ===== */

.main{
    flex:1;
    display:flex;
    flex-direction:column;
}

/* ===== TIMER ===== */

.timer-bar{
    height:60px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-bottom:1px solid #111;
    font-size:26px;
    color:var(--accent);
}

/* ===== HUB ===== */

.hub{
    flex:1;
    overflow:auto;
    padding:30px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
    gap:20px;
}

.card{
    background:#0e0e0e;
    height:100px;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    cursor:pointer;
    border:1px solid #151515;
    transition:.2s;
}

.card:hover{
    border-color:var(--accent);
}

/* ===== URL INPUT ===== */

.input-row{
    margin-bottom:25px;
    display:flex;
    gap:10px;
}

input{
    flex:1;
    background:black;
    border:1px solid #111;
    padding:10px;
    color:white;
}

button{
    background:var(--accent);
    border:none;
    padding:10px 14px;
    cursor:pointer;
    font-weight:bold;
}

/* ===== IFRAME VIEW ===== */

.viewer{
    position:fixed;
    inset:0;
    background:black;
    display:none;
    flex-direction:column;
}

.viewer.active{
    display:flex;
}

.viewer-header{
    height:45px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 15px;
    background:#080808;
    border-bottom:1px solid #111;
}

.viewer iframe{
    flex:1;
    border:none;
}

/* ===== FALLBACK ===== */

.fallback{
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    gap:15px;
}

.fallback a{
    color:var(--accent);
    text-decoration:none;
    font-size:18px;
}

</style>
</head>

<body>

<!-- ===== SIDEBAR ===== -->

<div class="sidebar" id="sidebar">

<h3>VOLUMES</h3>

<button class="island-btn active" data-island="School">School</button>
<button class="island-btn" data-island="Work">Work</button>
<button class="island-btn" data-island="Break">Break</button>

<div style="margin-top:auto">
<button onclick="toggleSidebar()">◀</button>
</div>

</div>

<!-- ===== MAIN ===== -->

<div class="main">

<div class="timer-bar" id="timer">25:00</div>

<div class="hub">

<div class="input-row">
<input id="urlInput" placeholder="// ADD_URL">
<button onclick="addLink()">+</button>
</div>

<div class="grid" id="grid"></div>

</div>

</div>

<!-- ===== VIEWER ===== -->

<div class="viewer" id="viewer">

<div class="viewer-header">
<span id="viewerTitle">PROTOCOL</span>
<button onclick="closeViewer()">TERMINATE</button>
</div>

<iframe id="frame"></iframe>

<div class="fallback" id="fallback" style="display:none">
<p>Site blocks embedded view.</p>
<a id="fallbackLink" target="_blank">Open in new tab →</a>
</div>

</div>


<script>

/* ===== DATA STORAGE ===== */

const STORAGE_KEY="probro_links";

let islands=JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
    School:["wikipedia.org"],
    Work:["github.com"],
    Break:["youtube.com"]
};

let currentIsland="School";

/* ===== TIMER ===== */

let time=1500;
let running=false;

setInterval(()=>{
    if(running && time>0) time--;

    let m=Math.floor(time/60).toString().padStart(2,"0");
    let s=(time%60).toString().padStart(2,"0");

    timer.textContent=`${m}:${s}`;
},1000);

timer.onclick=()=> running=!running;

/* ===== UTIL ===== */

function save(){
    localStorage.setItem(STORAGE_KEY,JSON.stringify(islands));
}

function sanitizeURL(url){
    url=url.trim();
    if(!url.startsWith("http")) url="https://"+url;
    return url;
}

/* ===== GRID RENDER ===== */

function render(){

    grid.innerHTML="";

    islands[currentIsland].forEach(link=>{
        let card=document.createElement("div");
        card.className="card";
        card.textContent=link;

        card.onclick=()=>openSite(link);

        grid.appendChild(card);
    });
}

/* ===== ADD LINK ===== */

function addLink(){

    let val=urlInput.value.trim().toLowerCase();
    if(!val) return;

    if(!islands[currentIsland].includes(val)){
        islands[currentIsland].push(val);
        save();
        render();
    }

    urlInput.value="";
}

/* ===== SIDEBAR ===== */

document.querySelectorAll(".island-btn").forEach(btn=>{
    btn.onclick=()=>{
        document.querySelectorAll(".island-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");

        currentIsland=btn.dataset.island;
        render();
    };
});

function toggleSidebar(){
    sidebar.classList.toggle("collapsed");
}

/* ===== VIEWER ===== */

function openSite(link){

    let safe=sanitizeURL(link);

    viewer.classList.add("active");
    viewerTitle.textContent=safe;

    fallback.style.display="none";
    frame.style.display="block";

    frame.src=safe;

    /* X-Frame fallback check */
    setTimeout(()=>{
        try{
            frame.contentWindow.location.href;
        }catch{
            frame.style.display="none";
            fallback.style.display="flex";
            fallbackLink.href=safe;
        }
    },1500);
}

function closeViewer(){
    viewer.classList.remove("active");
    frame.src="";
}

/* ===== INIT ===== */

render();

</script>

</body>
</html>
